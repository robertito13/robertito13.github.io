{"componentChunkName":"component---src-templates-post-tsx","path":"/wordpress-customizer-js-api/","result":{"data":{"site":{"siteMetadata":{"url":"https://rvaccaro.com.ar"}},"markdownRemark":{"id":"89979751-bda5-5585-ae1b-05e60765746d","html":"<p>A partir de la versión 4.1 de Wordpress implementó una API en Javascript que permite la creación y el control de todos los elementos del Customizer además del renderizado de controles a partir de plantillas de Underscore.</p>\n<p>Estas dos novedades permiten el manejo de los paneles, las secciones y los controles únicamente desde Javascript, abriendo un mundo de posibilidades.</p>\n<p>La organización de la API viene dada por el uso de colecciones para agrupar las instancias de los elementos que ya existen y modelos para la creación de nuevos. Las colecciones son:</p>\n<ul>\n<li>wp.customize.control</li>\n<li>wp.customize.panel</li>\n<li>wp.customize.section</li>\n</ul>\n<p>En tanto, los modelos son:</p>\n<ul>\n<li>wp.customize.Control</li>\n<li>wp.customize.Panel</li>\n<li>wp.customize.Section</li>\n</ul>\n<p>En el caso de los controles existen modelos específicos que extienden a Control y agregan características específicas para cada tipo:</p>\n<ul>\n<li>BackgroundControl</li>\n<li>BackgroundPositionControl</li>\n<li>CodeEditorControl</li>\n<li>CroppedImageControl</li>\n<li>DateTimeControl</li>\n<li>HeaderControl</li>\n<li>ImageControl</li>\n<li>MediaControl</li>\n<li>SiteIconControl</li>\n<li>UploadControl</li>\n</ul>\n<p>La utilización de las colecciones y los métodos es bastante intuitiva ya que sigue esquemas conocidos para los que tienen una base de Javascript y similares a los que se utiliza mediante la API PHP de Wordpress.Por ejemplo, </p>\n<p>Pero, antes de meternos de lleno, necesitamos que nuestro código se cargue cuando abramos el Customizer, para ello vamos a usar el hook <strong>customize_controls_enqueue_scripts</strong>:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">function wp_enqueue_customize_script() {\n    wp_enqueue_script( &#39;wp-customizer&#39;, get_template_directory_uri() . &#39;/scripts/customizer/main.js&#39;, [], null, true );\n}\n\nadd_action( &#39;customize_controls_enqueue_scripts&#39;, &#39;wp_enqueue_customize_script&#39; );</code></pre></div>\n<h2>Paneles</h2>\n<p>Para agregar paneles invocamos el método <strong>add</strong> de la colección <strong>panel</strong> que recibe como parámetro un objeto creado a partir del modelo Panel que, a su vez, recibe los mismos parámetros que <strong>$wp_customize->add_panel()</strong>:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">wp.customize.panel.add(\n    new api.Panel( &#39;wp_nuevo_panel&#39;, {\n        title: &#39;Nuevo panel&#39;,\n        priority: 25\n    })\n);</code></pre></div>\n<p>Lo que agregaría un panel con id <em>wp\\</em>nuevo_panel<em>, título _Nuevo panel</em> y prioridad <em>25</em>.</p>\n<p>A partir de que lo agreguemos podremos acceder al mismo mediante la colección de la siguiente manera:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">wp.customize.panel(&#39;wp_nuevo_panel&#39;).sections();</code></pre></div>\n<p>Lo que devuelve todas las secciones anidadas en este panel.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">wp.customize.panel(&#39;wp_nuevo_panel&#39;).params.title;</code></pre></div>\n<p>Que nos permite obtener el título del panel en cuestión.</p>\n<h2>Secciones</h2>\n<p>Las secciones siguen el mismo formato que los paneles:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">wp.customize.section.add(\n    new api.Section( &#39;wp_nueva_seccion&#39;, {\n        title: &#39;Nueva seccion&#39;,\n        panel: &#39;wp_nuevo_panel&#39;,\n        priority: 25,\n        customizeAction: &#39;Personalización&#39;\n    })\n);</code></pre></div>\n<p>Lo único particular que vemos es la opción <strong>customizeAction</strong> que representa el texto que aparece en la parte de arriba del título de la sección y que es necesario definirlo, <a href=\"https://core.trac.wordpress.org/ticket/42635\">por ahora</a>, porque no tiene valor predeterminado.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 345px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/dcdb176b0f5d68813d8da7cbb015a7a8/e4d6b/chrome_2018-10-20_21-55-09.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 102.02702702702702%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACdElEQVQ4y6WUy27TUBCGzQOwKBsW3BRYgGgLAgmJSkXwWhU70oAoVasu2KFu6DvQBSgURFuWSLQlxCV24saO7fie5p6fmZNaKMQOBY70a+xj+zv/zJxjybJt1Go12BTr9XqibJJDMkwLLz8VsLR1gJUP37D49iu2FQvLz3OYvT2N+QdzkGzLxN7+PizLmiinbkOpGriylsfZF+9wfjWPM4ubeLJVxNpSDjduXsf9uXuQZM2A57rksI4gCBBFEaIwHMYoREjXvu8LuZ6PzyUDH2Ud24c63hc06EETjxcWMDV1DplMBtLmFwX9VgtB2EC70yEoQQjmEzwgWOP4GH8a2WwWFy9dwMzMNKQ3BNRtTwBbrTYc14NHTjiyGM5jMBgI9fq/1On2xLOV1WXcuTuLh4/mh8CIYGF0jA459Mkhp+b5gQCy47TR7/dFfPosh6vXLhP0FqT8nopOo0GQQACbzSapdRKb5LqFXq+Hbrc7Jn6fx87uDtbXX2Fj4zUkkzroe55oCBeeI4ubwdFxnFR59B1vtwYZ4nKwYykIfOi6gYqmie1hGAa0oyNUq1UYtD/ZRbvdHpMoDxnghcW2OllE4kld11EofIeiqFDLZVQqGn6UShQrIuU0MYiz4M3PHHYs8Q3XiuvEq8aORI0oxiVIEkMZMgIMwwCKqtJpOYCqloUzWT5EUZbFfFIzYjGIUx4Bct4unRQ+z9wgcW5pzjRNSmlY8DTFjRlLmcVArkmNmsLXrjtciLuYJgbGccQhd7RYLFJTFNGIEqXNc+JPM+EvFD8fAcYf/L7H4pdPozEgi9NNuv5r4KR0TqNUh/+iROD/OEsC/gQMMcFNgfIWqAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"chrome 2018 10 20 21 55 09\"\n        title=\"chrome 2018 10 20 21 55 09\"\n        src=\"/static/dcdb176b0f5d68813d8da7cbb015a7a8/e4d6b/chrome_2018-10-20_21-55-09.png\"\n        srcset=\"/static/dcdb176b0f5d68813d8da7cbb015a7a8/12f09/chrome_2018-10-20_21-55-09.png 148w,\n/static/dcdb176b0f5d68813d8da7cbb015a7a8/e4a3f/chrome_2018-10-20_21-55-09.png 295w,\n/static/dcdb176b0f5d68813d8da7cbb015a7a8/e4d6b/chrome_2018-10-20_21-55-09.png 345w\"\n        sizes=\"(max-width: 345px) 100vw, 345px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Al igual que con los paneles, una vez agregada la sección, podemos acceder a la misma a través de la correspondiente colección:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">wp.customize.sections(&#39;wp_nueva_seccion&#39;).priority(30);</code></pre></div>\n<p>Lo que cambiaría la prioridad asignada al panel cambiando la posición del mismo. O:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">wp.customize.sections(&#39;wp_nueva_seccion&#39;).controls();</code></pre></div>\n<p>Para obtener la colección de controles que hay en la sección.</p>\n<h2>Controles</h2>\n<p>Llegamos a la parte más interesante del Customize, los controles. Por ahora vamos a ver la interacción desde la API y más adelante, en otro artículo, las potencialidades de las templates de Underscore.</p>\n<p>En este caso nos encontraremos con más particularidades que con los otros dos apartados porque los controles, para que sean finalmente almacenados en nuestra BBDD, tienen estar relacionados con una <strong>setting</strong>. Si bien se pueden <a href=\"https://wordpress.stackexchange.com/questions/280561/customizer-instantiating-settings-and-controls-via-javascript/280744#280744\">agregar settings de forma dinámica</a>, por ahora, sigue siendo más sencillo agregarlas desde PHP y utilizarlas desde Javascript.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">wp.customize.control.add(\n    new api.Control( &#39;wp_nueva_control&#39;, {\n        label: &#39;Texto&#39;,\n        section: &#39;wp_nueva_seccion&#39;,\n        setting: wp.customize( &#39;mi_setting_de_texto&#39; )\n    })\n);</code></pre></div>\n<p>Como vemos, un sencillo control de texto, no nos presenta ninguna dificultad. Lo único nuevo es la forma de pasar la <em>setting</em> y se debe a que <strong>wp.customize</strong> es, a su vez, la colección donde se almacenan las settings.</p>\n<p>Pero, por ejemplo, cuando queremos agregar un MediaControl necesitamos especificar además el texto de las etiquetas:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">wp.customize.control.add(\n    new api.MediaControl( &#39;anred_placemark_image_control&#39;, {\n        section: &#39;wp_nueva_seccion&#39;,\n        label: &#39;Logo&#39;,\n        setting: api( &#39;wp_logo_image&#39; ),\n        button_labels: {\n            change: &#39;Cambiar logo&#39;,\n            default: &#39;Sin logo&#39;,\n            frame_button: &#39;Elegir logo&#39;,\n            frame_title: &#39;Elegir logo&#39;,\n            placeholder: &#39;Logo no elegido&#39;,\n            remove: &#39;Quitar logo&#39;,\n            select: &#39;Elegir logo&#39;\n        }\n    }\n)</code></pre></div>\n<p>Hasta el momento no encontré ninguna referencia sobre qué parámetros tienen valor por defecto y cuales no para cada control. La fuente última para saberlo es el código de la API que se encuentra en <em>wp-admin/js/customize-controls.js</em> o el código PHP de los controles en la carpeta <em>wp-includes/customize/</em>.</p>","frontmatter":{"title":"Wordpress Customizer JS API","date":"October 21, 2018"}}},"pageContext":{"slug":"/wordpress-customizer-js-api/","previous":{"fields":{"slug":"/arquitectura-de-un-sitio-web/","source":"posts"},"frontmatter":{"title":"Arquitectura de un sitio web"}},"next":{"fields":{"slug":"/tdd-wordpress-theme/","source":"posts"},"frontmatter":{"title":"TDD Wordpress Theme"}}}}}